# All Fedora specific packages and configuration
packages:
  - fedora-bookmarks
  - fedora-chromium-config
  - fedora-flathub-remote
  - fedora-workstation-backgrounds
  - fedora-workstation-repositories

# Fedora specific packages for each variant
conditional-include:
  - if: variant == "silverblue"
    include:
      packages:
        - fedora-release-silverblue
  - if: variant == "kinoite"
    include:
      packages:
        - fedora-release-kinoite
        # Explicitely not included via comps
        # See: https://pagure.io/fedora-kde/SIG/issue/295
        - plasma-welcome-fedora
  - if: variant == "kinoite-mobile"
    include:
      packages:
        - fedora-release-kinoite
        # Explicitely not included via comps
        # See: https://pagure.io/fedora-kde/SIG/issue/295
        - plasma-welcome-fedora
  - if: variant == "sway-atomic"
    include:
      packages:
        - fedora-release-sway-atomic
  - if: variant == "budgie-atomic"
    include:
      packages:
        - fedora-release-budgie-atomic
  - if: variant == "cosmic-atomic"
    include:
      packages:
        - fedora-release-cosmic-atomic
  # Include ostree remote configuration only on classic ostree variants
  - if: bootable_container == false
    include:
      packages:
        - fedora-repos-ostree
  # Can only be excluded on variants that do not include GNOME Software
  - if: variant != "silverblue"
    include:
      exclude-packages:
        - PackageKit-glib

# Enable the fedora-third-party-refresh.service unit that was meant for Atomic
# Desktops but never got enabled.
# Remove the Google Chrome repo from the list of Fedora Third Party enabled
# repos. Workaround for https://github.com/coreos/rpm-ostree/issues/5494
postprocess:
  - |
    #!/bin/bash
    set -xeuo pipefail

    echo "enable fedora-third-party-refresh.service" >> /usr/lib/systemd/system-preset/81-atomic-desktop.preset

    sed -i -e '/google-chrome/,+2d' /usr/lib/fedora-third-party/conf.d/fedora-workstation.conf
